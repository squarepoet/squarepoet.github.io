<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8' />
    <link rel="stylesheet" href="/s/css/author.css" type="text/css" media="screen">
    <title>Piano Author V2</title>
    <!-- JS UTILS -->
    <script type="text/javascript" src="/s/js/jquery.min.js"></script>
    <script type="text/javascript" src="/s/js/lodash.min.js"></script>
    <!-- PENCILCODE's SIMPLE MUSICAL TONE GENERATING LIBRARY -->
    <script type="text/javascript" src="/s/js/musical.min.js"></script>
    <!-- JSMIDGEN - CREATE MIDI FILES -->
    <script type="text/javascript" src="/s/js/jsmidgen.js"></script>
    <!-- SQUAREPOET's AUTHORING TOOL -->
    <script type="text/javascript" src="/s/js/author/piano2.js"></script>

</head>

<body>
    <div style="float:right">
        shift &rarr; sharp &nbsp;&nbsp;&nbsp;&nbsp; ctrl &rarr; flat &nbsp;&nbsp;&nbsp;&nbsp; shift + esc &rarr; clear<br/> up/down &rarr; +/- octave &nbsp;&nbsp;&nbsp;&nbsp; tab &rarr; combine &nbsp;&nbsp;&nbsp;&nbsp; cmd + c &rarr; copy
    </div>
    <div style="float:right; margin-right:20px;">
        sharps: <input id="sharps_textarea"> flats: <input id="flats_textarea">
    </div>
    <div id="click">
        <div id="clickText">Copy</div>
        <div id="clickOverlay"></div>
    </div>
    <br/>

    <div id="content" style="width:100%; text-align:center;">
        <textarea id="textarea" rows="5" cols="80" style="width:1040px;"></textarea>
        <canvas id="pianoCanvas" width="1040" height="150" style="border: 1px solid #444;"></canvas>
    </div>
    <div style="margin:20px auto;width:200px;">
        Download <a id="download_midi_link" download="song.mid">MIDI</a> | <a id="download_text_link" href="data:text/plain;base64,SGVsbG8gV29ybGQh" download="song.txt">TEXT</a>
    </div>
    <script type="text/javascript">
        $(function() {
            // jsmidgen
            var file = new Midi.File();
            var track = new Midi.Track();
            track.setTempo(60); // BPM
            file.addTrack(track);

            var duration = 128; // 128 ticks == quarter note
            track.addNote(0, p2m(40), duration, 64 /* time since previous event */ ); // C4 == MIDI NOTE 60
            track.addNote(0, p2m(42), duration);
            track.addNote(0, p2m(44), duration);
            track.addNote(0, p2m(45), duration);
            track.addNote(0, p2m(47), duration);

            var base64URI = 'data:audio/midi;base64,' + btoa(file.toBytes());

            $('#download_midi_link').attr('href', base64URI);


            // TODO: use this in a 
            piano.tone({
                pitch: -p2m(40), // This API expects negative numbers to indicate MIDI notes. Positive numbers indicate audio tone frequency (Hz).
                duration: 1.0
            });

        });
    </script>
</body>

</html>